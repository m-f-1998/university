<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="Authenticate Your Education">
    <meta name="keywords" content="react-native, education, study, planner, dissertation">
    <meta name="author" content="Higher Education Study Planner">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles.css">
    <link rel="shortcut icon" type="image/png" href="/favicon.png"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>Authenticate Education</title>
  </head>
  <body>
    <img src="./favicon.png" alt="Logo" width="200" height="200">
    <form id="education_form">
      <h1 style="color:white;">
        The University of Edinburgh
      </h1>
      <h2 style="color:white;">
        Login
      </h2>
      <br /><p style="color:white;">
        Email:
      </p>
      <input id="email" name="email" type="email">
      <br /><br />
      <p style="color:white;">
        Password:
      </p>
      <input id="pass" name="pass" type="password">
      <br /> <br />
      <input id="input" type="submit">
    </form>
    <p id="result" style="color:white;"></p>
    <script>
      $( "#education_form" ).submit( function( e ) {
        e.preventDefault();
        var email = $( "#email" ).val();
        var pass = $( "#pass" ).val();
        var url = './authenticateUniversity.php';
        const expression = /(?!.*\.{2})^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([\t]*\r\n)?[\t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([\t]*\r\n)?[\t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;

        if ( expression.test( email.toString().toLowerCase() ) ) { // Test E-Mail Is Valid On Lower Case For Realism
          if ( email.endsWith( ".ac.uk" ) ) { // Must Be Education Email
            var request = new XMLHttpRequest();
            request.open( 'POST', url );

            var form_data = new FormData();
            form_data.append('institute', '3'); // Unique Code For Each University Pass Back Would Be Given On Uni Registration
            form_data.append('email', email);
            form_data.append('password', pass);

            request.timeout = 5000;
            request.onreadystatechange = function() {
              if ( request.readyState == XMLHttpRequest.DONE ) {
                var response = JSON.parse(request.responseText);
                if ( response['error'] ) {
                  alert( response['message'] );
                } else {
                  $( "#result" ).html("Authentication Successful!! <br /><br />Your Unique Authentication Code Is: <br />" + JSON.parse(request.responseText)['code'] + "<br /><br />Enter This Code In The Study Planner Mobile Application To Continue.<br /><br />" + JSON.parse(request.responseText)['notice']);
                }
              }
              // Pass Back Response - Would Like To Have Deep Linked //
            }
            request.onerror = function () {
              alert( 'An Unkown Error Occured. Please Try Again Later' );
            };
            request.ontimeout = function () {
              alert( 'Request Timed Out. A Stable Connection Is Required.' );
            };
            request.send( form_data );
          } else {
            alert( 'Your Registered Email Must Be An Educational Address' );
          }
        } else {
          alert( 'Please Enter A Valid Email' );
        }
      });
    </script>
  </body>
</html>
